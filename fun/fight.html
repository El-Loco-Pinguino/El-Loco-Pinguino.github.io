<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Super-Patate VS Evil Cassoulet !</title>

    <style>
        td {
            padding: 0 1em;
        }

        progress[value] {
            width: 60vw;
            height: 20px;
        }

    </style>
</head>
<body>
    <div id="actions">
        <button onclick="attack(hero, foe)">Attaque</button>
        <button onclick="provoke(hero, foe)">Provoquer</button>
        <button onclick="skill(hero, foe)">Aptitude</button>
    </div>

    <div id="jauges">

    </div>

    <div id="history">

    </div>
    <script>
        const hero = {
            name: "Super-Patate",
            hp: 700,
            maxhp: 700,
            atk: 55,
            def: 28,
            skill: "Semi-Vie"
        }

        const foe = {
            name: "Evil Cassoulet",
            hp: 1000,
            maxhp: 1000,
            atk: 38,
            def: 22,
            skill: "Guillotine"
        }

        document.getElementById("jauges").innerHTML = `<table>
        <tr>
            <td>Super Patate</td>
            <td><progress min="0" max=${hero.maxhp} value=${hero.hp}></progress></td>
            <td>${hero.hp} / ${hero.maxhp}</td>
            <td>Force: ${hero.atk}</td>
            <td>Défense: ${hero.def}</td>
        </tr>
        <tr>
            <td>Evil Cassoulet</td>
            <td><progress min="0" max=${foe.maxhp} value=${foe.hp}></progress></td>
            <td>${foe.hp} / ${foe.maxhp}</td>
            <td>Force: ${foe.atk}</td>
            <td>Défense: ${foe.def}</td>
        </tr>
        </table>`

        let inFight = true

        const updateGauge = () => {
            document.getElementById("jauges").innerHTML = `<table>
        <tr>
            <td>Super Patate</td>
            <td><progress min="0" max=${hero.maxhp} value=${hero.hp}></progress></td>
            <td>${hero.hp} / ${hero.maxhp}</td>
            <td>Force: ${hero.atk}</td>
            <td>Défense: ${hero.def}</td>
        </tr>
        <tr>
            <td>Evil Cassoulet</td>
            <td><progress min="0" max=${foe.maxhp} value=${foe.hp}></progress></td>
            <td>${foe.hp} / ${foe.maxhp}</td>
            <td>Force: ${foe.atk}</td>
            <td>Défense: ${foe.def}</td>
        </tr>
        </table>`
        }
        
        const attack = (user, target) => {
            if (inFight) {
                let damage = Math.floor((user.atk * 2 - foe.def) * ((Math.random() * 110 + 80) / 100))
                if (damage > 0) {
                    Math.random() >= 0.9 ? damage *= 3 : damage
                    target.hp -= damage
                    document.getElementById("history").innerHTML += `<li>${user.name} attaque pour ${damage} dégâts !</li>`
                    if (target.hp <= 0) {
                        target.hp = 0
                        updateGauge()
                        document.getElementById("history").innerHTML += `<li>${user.name} a gagné le combat !</li>`
                        inFight = false
                    } else {
                        updateGauge()
                    }
                } else {
                    document.getElementById("history").innerHTML += `<li>${user.name} n'a infligé aucun dégât !</li>`
                }
                if (user === hero) {
                    randomFoeAction()
                }
            }
        }

        const provoke = (user, target) => {
            if (inFight) {
                if (target.atk > 2) {
                    document.getElementById("history").innerHTML += `<li>${user.name} provoque l'adversaire et baisse sa force de 2 points !</li>`
                    updateGauge()
                    target.atk -= 2
                } else {
                    document.getElementById("history").innerHTML += `<li>${target.name} ne peut pas perdre davantage de force !</li>`
                }
                if (user === hero) {
                    randomFoeAction()
                }
            }
        }

        const skill = (user, target) => {
            if (inFight) {
                    document.getElementById("history").innerHTML += `<li>${user.name} utilise l'aptitude ${user.skill} !</li>`
                    switch (user.skill) {
                        case "Semi-Vie":
                            damage = Math.floor(target.hp / 2)
                            target.hp -= damage
                            updateGauge()
                            document.getElementById("history").innerHTML += `<li>${target.name} perd la moitié de sa vie, soit ${damage} points !</li>`
                            break
                        case "Guillotine":
                            let precision = Math.random()
                            if (precision < 0.05) {
                                target.hp = 0
                                updateGauge()
                                document.getElementById("history").innerHTML += `<li>${target.name} meurt instantanément !</li>`
                                inFight = false
                            } else {
                                document.getElementById("history").innerHTML += `<li>${user.name} a raté son attaque !</li>`
                            }
                            break
                    }
                    if (user === hero) {
                        randomFoeAction()
                    }
                }
            }

        const randomFoeAction = () => {
            if (inFight) {
                let alea = Math.floor(Math.random() * 3 + 1)
                switch (alea) {
                    case 1:
                        attack(foe, hero)
                        updateGauge()
                        break
                    case 2:
                        provoke(foe, hero)
                        updateGauge()
                        break
                    case 3:
                        skill(foe, hero)
                        updateGauge()
                        break
                }
            }
        }
        
    </script>
</body>
</html>